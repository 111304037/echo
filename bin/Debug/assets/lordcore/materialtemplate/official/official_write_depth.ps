#version 100

varying mediump vec4 vScreenPos;

#ifdef ALPHA_TEST
varying mediump vec2 texCoord;
uniform sampler2D tShadowAlbedo;
#endif

void main(void)
{
	#ifdef ALPHA_TEST
		mediump float alpha = texture2D(tShadowAlbedo, texCoord).a;
		if (alpha < 0.5)
		{
			discard;
		}
	#endif

    mediump float depth = vScreenPos.z / vScreenPos.w;

// 	depth = exp(depth*9.0);

	mediump vec4 enc = vec4(1.0, 255.0, 65025.0, 16581375.0) * depth;
	enc  = fract(enc);
	enc -= enc.yzww * vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0, 0);

	gl_FragColor = enc;
}