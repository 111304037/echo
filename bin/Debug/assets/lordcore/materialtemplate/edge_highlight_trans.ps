#version 100
precision mediump float;

uniform vec4  RimColor;
uniform float RimPower;
uniform float RimInten;
uniform sampler2D Albedo;
uniform float AlbedoAtten;
uniform mediump float Alpha;

varying vec2 v2f_texcoord0;
varying vec3 v2f_normal;
varying vec3 v2f_view;

void main(void)
{
    vec4 surfaceColor = texture2D(Albedo, v2f_texcoord0);
    vec3 v = normalize(v2f_view);
    float rim = 1.0 - max(dot(v, v2f_normal), 0.0);
    
	gl_FragColor.rgb = surfaceColor.rgb * AlbedoAtten + RimColor.rgb * pow(rim, RimPower) * RimInten;
    gl_FragColor.a = rim * surfaceColor.a;
    
    gl_FragColor.a = gl_FragColor.a * Alpha;
}