#version 100
precision mediump float;
#include <tonemapping.inc>
#include <fog_ps.inc>

uniform sampler2D Albedo;
uniform mediump float DiffuseIntensity;

varying vec2 texCoord;


#ifdef RECEIVE_FOG
	varying vec4 ofogColor;
#endif

#ifdef GROW
uniform sampler2D GrowMaskSampler;
uniform mediump float GrowAlpha;
varying vec2 texCoord1;
#endif

void main(void)
{
#ifdef GROW
mediump float grow = texture2D(GrowMaskSampler, texCoord1).r + GrowAlpha;
	if(grow < 1.)
	{
		discard;
	}	
#endif

    vec4 surfaceColor = texture2D(Albedo, texCoord);
	surfaceColor.rgb *= DiffuseIntensity;
	surfaceColor.rgb = toneACESlum(surfaceColor.rgb, 0.4);
	gl_FragColor = surfaceColor;
	
#ifdef RECEIVE_FOG
	gl_FragColor.xyz = mix(ofogColor.xyz, gl_FragColor.xyz, ofogColor.a);
	gl_FragColor.rgb = mix(gl_FragColor.rgb, varHeightFog.rgb, ComputeHeightFog(varHeightFog.a));
#endif
}