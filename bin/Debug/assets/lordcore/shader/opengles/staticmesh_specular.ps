#version 100

uniform sampler2D texSampler;
uniform mediump vec4 naturalColor;   // 
uniform mediump vec4 ActorLitParam[3];// 0.sunDir  1.sunColor 2.environmentColor
uniform mediump vec2 litIntensity;
uniform mediump float specularPow;

varying mediump vec2 texCoord;
varying mediump vec3 normal;
varying mediump vec3 Eye;

void main(void)
{
    mediump vec4 	baseColor = texture2D(texSampler, texCoord);
		mediump vec3 	light		 	= normalize(ActorLitParam[0].xyz);
		mediump vec3 	eye			 	= normalize(Eye);
		mediump float ndl				= clamp(dot(light,normal),0.0,1.0); 
   	mediump vec3  r					= normalize(reflect(-light,normal));
   	mediump vec3 environmentColor = ActorLitParam[2].rgb;
   	mediump vec3 diffuseColor     = ndl * ActorLitParam[1].rgb * litIntensity.x;
   	mediump vec3 specularColor    = pow(clamp(dot(r,eye),0.0,1.0),specularPow) * ActorLitParam[1].rgb * litIntensity.y * baseColor.a;
  
    gl_FragColor.rgb = naturalColor.xyz *( baseColor.xyz * ( environmentColor + diffuseColor) + specularColor);
    gl_FragColor.a   = 1.0;
}