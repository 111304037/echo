#version 100

uniform mediump float RenderSun;
uniform mediump vec4 SunColor;
uniform mediump vec3 SunDir;
uniform mediump vec4 SunIntensityArea;
uniform samplerCube cubeMap;
varying mediump vec3 texcoord;


void main(void)
{
	mediump vec3 PixelDir = normalize(texcoord);
	mediump vec3 env_color = textureCube(cubeMap,PixelDir ).xyz;
	gl_FragColor = vec4(env_color.xyz, 1.0);

	
	mediump float sun_intensity = dot(PixelDir, normalize(SunDir));
	sun_intensity = max(0.0, sun_intensity);
	sun_intensity = pow(sun_intensity, SunIntensityArea.y)*SunIntensityArea.x;
	mediump vec3 sun_color = SunColor.xyz * sun_intensity;

	sun_color *= RenderSun;
	
	gl_FragColor.xyz += sun_color;
	gl_FragColor.a = sun_intensity*RenderSun;
}