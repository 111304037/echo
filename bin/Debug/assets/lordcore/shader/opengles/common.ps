#version 100
precision mediump float;

uniform sampler2D texSampler;

varying mediump vec4 color;
varying mediump vec2 texCoord;

#include <tonemapping.inc>
#include <hdr_ldr.inc>

vec3 invToneExp(vec3 inColor)
{
	return - log(vec3(1.0) - inColor*0.9);
}

void main(void)
{
	mediump vec4 textureColor = texture2D(texSampler, texCoord);
	vec4 origColor = textureColor * color;
	vec3 linearSpaceColor = origColor.rgb * origColor.rgb ;
	linearSpaceColor = invToneExp(linearSpaceColor) * 2.0;
	gl_FragColor = vec4(linearSpaceColor, origColor.a);
	gl_FragColor = hdr2ldr(gl_FragColor);
}