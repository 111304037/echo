#version 100

uniform sampler2D texSampler;

uniform mediump mat4 arrayDSGOffset;

varying mediump vec2 texCoord;


void main(void)
{
	mediump float average_gray_value = 0.0;
	mediump float max_gray_value = -1e20;
	mediump vec4 color = vec4( 0.0, 0.0, 0.0, 0.0 );
	mediump vec3 weight = vec3(0.299, 0.587, 0.114);
	
	
	for( int i = 0; i < 4; i++ )
	{
		color = texture2D(texSampler, texCoord + vec2(arrayDSGOffset[i].x, arrayDSGOffset[i].y));
		mediump float gray_value =  dot( color.rgb, weight );//max( color.r, max(color.g, color.b) );
		max_gray_value = max( gray_value, max_gray_value );
		average_gray_value += (0.25 * log(1e-5 + gray_value));
	}
	average_gray_value = exp( average_gray_value ) * 1.3;
	gl_FragColor = vec4( average_gray_value, max_gray_value, 0.0, 1.0 );
}