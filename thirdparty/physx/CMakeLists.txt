# set module name
SET(MODULE_NAME physx)

# message
MESSAGE( STATUS "Configuring module: ${MODULE_NAME} ...")

# include directories
INCLUDE_DIRECTORIES(${CMAKE_CURRENT_SOURCE_DIR})
INCLUDE_DIRECTORIES(${CMAKE_CURRENT_SOURCE_DIR}/pxshared/include)
INCLUDE_DIRECTORIES(${CMAKE_CURRENT_SOURCE_DIR}/physx/source/common/include)

# link directories
LINK_DIRECTORIES(${CMAKE_LIBRARY_OUTPUT_DIRECTORY})

# set module path
SET(MODULE_PATH ${CMAKE_CURRENT_SOURCE_DIR})

# query all files recursively
FILE(GLOB_RECURSE ALL_FILES ${MODULE_PATH}/*.h ${MODULE_PATH}/*.inl ${MODULE_PATH}/*.cpp ${MODULE_PATH}/*.cxx ${MODULE_PATH}/*.mm ${MODULE_PATH}/*.c)

# remove files by platform
IF(ECHO_PLATFORM_WINDOWS)
    EXCLUDE_FILES(ALL_FILES GLOB_RECURSE ${MODULE_PATH}/physx/source/foundation/src/unix/*.*)
	EXCLUDE_FILES(ALL_FILES GLOB_RECURSE ${MODULE_PATH}/physx/source/physx/src/device/linux/*.*)
ELSEIF(ECHO_PLATFORM_MAC OR ECHO_PLATFORM_LINUX OR ECHO_PLATFORM_IOS OR ECHO_PLATFORM_ANDROID)
    EXCLUDE_FILES(ALL_FILES GLOB_RECURSE ${MODULE_PATH}/physx/source/foundation/include/windows/*.*)
    EXCLUDE_FILES(ALL_FILES GLOB_RECURSE ${MODULE_PATH}/physx/source/foundation/src/windows/*.*)
    EXCLUDE_FILES(ALL_FILES GLOB_RECURSE ${MODULE_PATH}/physx/source/physx/src/device/windows/*.*)
    EXCLUDE_FILES(ALL_FILES GLOB_RECURSE ${MODULE_PATH}/physx/source/common/include/windows/*.*)
    EXCLUDE_FILES(ALL_FILES GLOB_RECURSE ${MODULE_PATH}/physx/source/common/src/windows/*.*)
    EXCLUDE_FILES(ALL_FILES GLOB_RECURSE ${MODULE_PATH}/physx/source/physx/src/windows/*.*)
    EXCLUDE_FILES(ALL_FILES GLOB_RECURSE ${MODULE_PATH}/physx/source/physxcooking/src/windows/*.*)
ENDIF()

# group files by folder
GROUP_FILES(ALL_FILES ${CMAKE_CURRENT_SOURCE_DIR})

# add macro
IF(ECHO_PLATFORM_IOS OR ECHO_PLATFORM_MAC OR ECHO_PLATFORM_ANDROID OR ECHO_PLATFORM_LINUX)
	ADD_DEFINITIONS(-DNDEBUG)
ENDIF()
ADD_DEFINITIONS(-DPX_PHYSX_STATIC_LIB)
ADD_DEFINITIONS(-DPX_FOUNDATION_NO_EXPORTS)
ADD_DEFINITIONS(-DPX_PHYSX_GPU_STATIC)
ADD_DEFINITIONS(-DPX_COOKING)
ADD_DEFINITIONS(-DDISABLE_CUDA_PHYSX)
ADD_DEFINITIONS(-DPX_SUPPORT_PVD)

# add new library
ADD_LIBRARY(${MODULE_NAME} STATIC ${ALL_FILES} CMakeLists.txt)

# set target folder
SET_TARGET_PROPERTIES(${MODULE_NAME} PROPERTIES FOLDER "thirdparty")

MESSAGE(STATUS "configure success!")
