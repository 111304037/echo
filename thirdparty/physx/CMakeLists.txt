MESSAGE(STATUS "configuring module: physx...")

# include directories 
INCLUDE_DIRECTORIES(${CMAKE_CURRENT_SOURCE_DIR})
INCLUDE_DIRECTORIES(${CMAKE_CURRENT_SOURCE_DIR}/pxshared/include)
INCLUDE_DIRECTORIES(${CMAKE_CURRENT_SOURCE_DIR}/physx/source/common/include)

# link directories
LINK_DIRECTORIES(${CMAKE_LIBRARY_OUTPUT_DIRECTORY})

# set module path
SET(MODULE_PATH ${CMAKE_CURRENT_SOURCE_DIR})

# query all files recursively
FILE(GLOB_RECURSE HEADER_FILES ${MODULE_PATH}/*.h ${MODULE_PATH}/*.inl)
FILE(GLOB_RECURSE SOURCE_FILES ${MODULE_PATH}/*.cpp ${MODULE_PATH}/*.cxx ${MODULE_PATH}/*.mm ${MODULE_PATH}/*.c)
SET(ALL_FILES ${HEADER_FILES} ${SOURCE_FILES})

# remove files by platform
IF(ECHO_PLATFORM_WIN32)
    EXCLUDE_FILES(ALL_FILES GLOB_RECURSE ${MODULE_PATH}/physx/source/foundation/src/unix/*.*)
	EXCLUDE_FILES(ALL_FILES GLOB_RECURSE ${MODULE_PATH}/physx/source/physx/src/device/linux/*.*)
ELSEIF(ECHO_PLATFORM_MAC)
    EXCLUDE_FILES(ALL_FILES GLOB_RECURSE ${MODULE_PATH}/physx/source/foundation/include/windows/*.*)
    EXCLUDE_FILES(ALL_FILES GLOB_RECURSE ${MODULE_PATH}/physx/source/foundation/src/windows/*.*)
    EXCLUDE_FILES(ALL_FILES GLOB_RECURSE ${MODULE_PATH}/physx/source/physx/src/device/windows/*.*)
    EXCLUDE_FILES(ALL_FILES GLOB_RECURSE ${MODULE_PATH}/physx/source/common/include/windows/*.*)
    EXCLUDE_FILES(ALL_FILES GLOB_RECURSE ${MODULE_PATH}/physx/source/common/src/windows/*.*)
    EXCLUDE_FILES(ALL_FILES GLOB_RECURSE ${MODULE_PATH}/physx/source/physx/src/windows/*.*)
    EXCLUDE_FILES(ALL_FILES GLOB_RECURSE ${MODULE_PATH}/physx/source/physxcooking/src/windows/*.*)
ELSEIF(ECHO_PLATFORM_IOS)
    EXCLUDE_FILES(ALL_FILES GLOB_RECURSE ${MODULE_PATH}/PhysXSDK/Source/LowLevelCloth/*.*)
    EXCLUDE_FILES(ALL_FILES GLOB_RECURSE ${MODULE_PATH}/PhysXSDK/Source/PhysX/src/device/windows/*.*)
    EXCLUDE_FILES(ALL_FILES GLOB_RECURSE ${MODULE_PATH}/PhysXSDK/Source/PhysX/src/windows/*.*)
    EXCLUDE_FILES(ALL_FILES GLOB_RECURSE ${MODULE_PATH}/PhysXSDK/Source/foundation/include/windows/*.*)
    EXCLUDE_FILES(ALL_FILES GLOB_RECURSE ${MODULE_PATH}/PhysXSDK/Source/foundation/src/windows/*.*)
    EXCLUDE_FILES(ALL_FILES GLOB_RECURSE ${MODULE_PATH}/PhysXSDK/Source/PhysXCooking/src/windows/*.*)
ELSEIF(ECHO_PLATFORM_ANDROID)
	EXCLUDE_FILES(ALL_FILES GLOB_RECURSE ${MODULE_PATH}/PhysXSDK/Source/LowLevelCloth/src/avx/*.*)
	EXCLUDE_FILES(ALL_FILES GLOB_RECURSE ${MODULE_PATH}/PhysXSDK/Source/LowLevelCloth/src/neon/*.*)
	EXCLUDE_FILES(ALL_FILES GLOB_RECURSE ${MODULE_PATH}/PhysXSDK/Source/LowLevelCloth/src/windows/*.*)
	EXCLUDE_FILES(ALL_FILES GLOB_RECURSE ${MODULE_PATH}/PhysXSDK/Source/PhysX/src/device/windows/*.*)
    EXCLUDE_FILES(ALL_FILES GLOB_RECURSE ${MODULE_PATH}/PhysXSDK/Source/PhysX/src/windows/*.*)
    #EXCLUDE_FILES(ALL_FILES GLOB_RECURSE ${MODULE_PATH}/PhysXSDK/Source/foundation/include/windows/*.*)
    EXCLUDE_FILES(ALL_FILES GLOB_RECURSE ${MODULE_PATH}/PhysXSDK/Source/foundation/src/windows/*.*)
    EXCLUDE_FILES(ALL_FILES GLOB_RECURSE ${MODULE_PATH}/PhysXSDK/Source/PhysXCooking/src/windows/*.*)
ENDIF()

# group files by folder
GROUP_FILES(ALL_FILES ${CMAKE_CURRENT_SOURCE_DIR})

# add macro
IF(ECHO_PLATFORM_IOS OR ECHO_PLATFORM_MAC)
	ADD_DEFINITIONS(-DNDEBUG)
ENDIF()
ADD_DEFINITIONS(-DPX_PHYSX_STATIC_LIB)
ADD_DEFINITIONS(-DPX_FOUNDATION_NO_EXPORTS)
ADD_DEFINITIONS(-DPX_PHYSX_GPU_STATIC)
ADD_DEFINITIONS(-DPX_COOKING)
ADD_DEFINITIONS(-DDISABLE_CUDA_PHYSX)

# set module name
SET(MODULE_NAME physx)

# add new library
ADD_LIBRARY(${MODULE_NAME} STATIC ${ALL_FILES} CMakeLists.txt)

# set target folder
SET_TARGET_PROPERTIES(${MODULE_NAME} PROPERTIES FOLDER "thirdparty")

MESSAGE(STATUS "baseserver configure success!")
