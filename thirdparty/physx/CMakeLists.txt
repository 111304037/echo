MESSAGE(STATUS "configuring module: physx...")

# 附加包含目录
SET(INCLUDE_FILES
	${CMAKE_CURRENT_SOURCE_DIR}
	${CMAKE_CURRENT_SOURCE_DIR}/PhysXSDK/Source/SimulationController/include
	${CMAKE_CURRENT_SOURCE_DIR}/PhysXSDK/Source/SimulationController/src/cloth
	${CMAKE_CURRENT_SOURCE_DIR}/PhysXSDK/Source/SimulationController/src/particles
	${CMAKE_CURRENT_SOURCE_DIR}/PhysXSDK/Source/SimulationController/src/framework
	${CMAKE_CURRENT_SOURCE_DIR}/PhysXSDK/Source/PhysX/src/buffering
	${CMAKE_CURRENT_SOURCE_DIR}/PhysXSDK/Source/SceneQuery
	${ECHO_ROOT_PATH}
	${ECHO_ROOT_PATH}/thirdparty
)

INCLUDE_DIRECTORIES( ${INCLUDE_FILES})

# 链接库
LINK_DIRECTORIES(${CMAKE_LIBRARY_OUTPUT_DIRECTORY})

# 设置项目路径
SET(MODULE_PATH ${CMAKE_CURRENT_SOURCE_DIR})

# 递归获取所有c++文件
FILE(GLOB_RECURSE HEADER_FILES ${MODULE_PATH}/*.h ${MODULE_PATH}/*.inl)
FILE(GLOB_RECURSE SOURCE_FILES ${MODULE_PATH}/*.cpp ${MODULE_PATH}/*.cxx ${MODULE_PATH}/*.mm ${MODULE_PATH}/*.c)
SET(ALL_FILES ${HEADER_FILES} ${SOURCE_FILES})

# 移除文件
IF(ECHO_PLATFORM_WIN32)
    EXCLUDE_FILES(ALL_FILES GLOB_RECURSE ${MODULE_PATH}/PhysXSDK/Source/foundation/src/unix/*.*)
    #EXCLUDE_FILES(ALL_FILES GLOB_RECURSE ${MODULE_PATH}/PhysXSDK/Source/LowLevelCloth/src/neon/*.*)
    #EXCLUDE_FILES(ALL_FILES GLOB_RECURSE ${MODULE_PATH}/PhysXSDK/Source/LowLevelCloth/src/windows/*.*)
	EXCLUDE_FILES(ALL_FILES GLOB_RECURSE ${MODULE_PATH}/PhysXSDK/Source/PhysX/src/device/linux/*.*)
	EXCLUDE_FILES(ALL_FILES GLOB_RECURSE ${MODULE_PATH}/APEXSDK/externals/nvToolsExt/*.*)
	EXCLUDE_FILES(ALL_FILES GLOB_RECURSE ${MODULE_PATH}/APEXSDK/common/include/ApexCuda*)
	EXCLUDE_FILES(ALL_FILES GLOB_RECURSE ${MODULE_PATH}/APEXSDK/common/src/ApexCuda*)
	EXCLUDE_FILES(ALL_FILES GLOB_RECURSE ${MODULE_PATH}/APEXSDK/shared/external/*.*)
	EXCLUDE_FILES(ALL_FILES GLOB_RECURSE ${MODULE_PATH}/APEXSDK/common/include/linux/*.*)
	EXCLUDE_FILES(ALL_FILES GLOB_RECURSE ${MODULE_PATH}/APEXSDK/module/clothing/embedded/LowLevelCloth/src/neon/*.*)
	EXCLUDE_FILES(ALL_FILES GLOB_RECURSE ${MODULE_PATH}/PhysXSDK/Source/PhysX/src/device/windows/*.*)
	EXCLUDE_FILES(ALL_FILES GLOB_RECURSE ${MODULE_PATH}/PhysXSDK/Source/LowLevelCloth/*.*)
	#EXCLUDE_FILES(ALL_FILES GLOB_RECURSE ${MODULE_PATH}/APEXSDK/*.*)
ELSEIF(ECHO_PLATFORM_MAC)
	EXCLUDE_FILES(ALL_FILES GLOB_RECURSE ${MODULE_PATH}/PhysXSDK/Source/LowLevelCloth/*.*)
	EXCLUDE_FILES(ALL_FILES GLOB_RECURSE ${MODULE_PATH}/PhysXSDK/Source/PhysX/src/device/windows/*.*)
	EXCLUDE_FILES(ALL_FILES GLOB_RECURSE ${MODULE_PATH}/PhysXSDK/Source/PhysX/src/windows/*.*)
	EXCLUDE_FILES(ALL_FILES GLOB_RECURSE ${MODULE_PATH}/PhysXSDK/Source/foundation/include/windows/*.*)
	EXCLUDE_FILES(ALL_FILES GLOB_RECURSE ${MODULE_PATH}/PhysXSDK/Source/foundation/src/windows/*.*)
	EXCLUDE_FILES(ALL_FILES GLOB_RECURSE ${MODULE_PATH}/PhysXSDK/Source/PhysXCooking/src/windows/*.*)
	EXCLUDE_FILES(ALL_FILES GLOB_RECURSE ${MODULE_PATH}/APEXSDK/externals/nvToolsExt/*.*)
	EXCLUDE_FILES(ALL_FILES GLOB_RECURSE ${MODULE_PATH}/APEXSDK/common/include/ApexCuda*)
	EXCLUDE_FILES(ALL_FILES GLOB_RECURSE ${MODULE_PATH}/APEXSDK/common/src/ApexCuda*)
	EXCLUDE_FILES(ALL_FILES GLOB_RECURSE ${MODULE_PATH}/APEXSDK/shared/external/*.*)
	EXCLUDE_FILES(ALL_FILES GLOB_RECURSE ${MODULE_PATH}/APEXSDK/module/clothing/embedded/LowLevelCloth/src/neon/*.*)
	EXCLUDE_FILES(ALL_FILES GLOB_RECURSE ${MODULE_PATH}/APEXSDK/module/clothing/embedded/LowLevelCloth/src/avx/*.*)
	EXCLUDE_FILES(ALL_FILES GLOB_RECURSE ${MODULE_PATH}/APEXSDK/framework/src/windows/*.*)
	EXCLUDE_FILES(ALL_FILES GLOB_RECURSE ${MODULE_PATH}/APEXSDK/common/include/windows/*.*)
	EXCLUDE_FILES(ALL_FILES GLOB_RECURSE ${MODULE_PATH}/APEXSDK/shared/general/meshimport/*.*)
ELSEIF(ECHO_PLATFORM_IOS)
    EXCLUDE_FILES(ALL_FILES GLOB_RECURSE ${MODULE_PATH}/PhysXSDK/Source/LowLevelCloth/*.*)
    EXCLUDE_FILES(ALL_FILES GLOB_RECURSE ${MODULE_PATH}/PhysXSDK/Source/PhysX/src/device/windows/*.*)
    EXCLUDE_FILES(ALL_FILES GLOB_RECURSE ${MODULE_PATH}/PhysXSDK/Source/PhysX/src/windows/*.*)
    EXCLUDE_FILES(ALL_FILES GLOB_RECURSE ${MODULE_PATH}/PhysXSDK/Source/foundation/include/windows/*.*)
    EXCLUDE_FILES(ALL_FILES GLOB_RECURSE ${MODULE_PATH}/PhysXSDK/Source/foundation/src/windows/*.*)
    EXCLUDE_FILES(ALL_FILES GLOB_RECURSE ${MODULE_PATH}/PhysXSDK/Source/PhysXCooking/src/windows/*.*)
	#EXCLUDE_FILES(ALL_FILES GLOB_RECURSE ${MODULE_PATH}/APEXSDK/*.*)
	EXCLUDE_FILES(ALL_FILES GLOB_RECURSE ${MODULE_PATH}/APEXSDK/externals/nvToolsExt/*.*)
	EXCLUDE_FILES(ALL_FILES GLOB_RECURSE ${MODULE_PATH}/APEXSDK/common/include/ApexCuda*)
	EXCLUDE_FILES(ALL_FILES GLOB_RECURSE ${MODULE_PATH}/APEXSDK/common/src/ApexCuda*)
	EXCLUDE_FILES(ALL_FILES GLOB_RECURSE ${MODULE_PATH}/APEXSDK/shared/external/*.*)
	EXCLUDE_FILES(ALL_FILES GLOB_RECURSE ${MODULE_PATH}/APEXSDK/module/clothing/embedded/LowLevelCloth/src/neon/*.*)
	EXCLUDE_FILES(ALL_FILES GLOB_RECURSE ${MODULE_PATH}/APEXSDK/module/clothing/embedded/LowLevelCloth/src/avx/*.*)
	EXCLUDE_FILES(ALL_FILES GLOB_RECURSE ${MODULE_PATH}/APEXSDK/framework/src/windows/*.*)
	#EXCLUDE_FILES(ALL_FILES GLOB_RECURSE ${MODULE_PATH}/APEXSDK/common/include/linux/*.*)
	EXCLUDE_FILES(ALL_FILES GLOB_RECURSE ${MODULE_PATH}/APEXSDK/common/include/windows/*.*)
	EXCLUDE_FILES(ALL_FILES GLOB_RECURSE ${MODULE_PATH}/APEXSDK/shared/general/meshimport/*.*)
ELSEIF(ECHO_PLATFORM_ANDROID)
	EXCLUDE_FILES(ALL_FILES GLOB_RECURSE ${MODULE_PATH}/APEXSDK/*.*)
	EXCLUDE_FILES(ALL_FILES GLOB_RECURSE ${MODULE_PATH}/Echo/EchoCloth/*.*)
	EXCLUDE_FILES(ALL_FILES GLOB_RECURSE ${MODULE_PATH}/PhysXSDK/Source/LowLevelCloth/src/avx/*.*)
	EXCLUDE_FILES(ALL_FILES GLOB_RECURSE ${MODULE_PATH}/PhysXSDK/Source/LowLevelCloth/src/neon/*.*)
	EXCLUDE_FILES(ALL_FILES GLOB_RECURSE ${MODULE_PATH}/PhysXSDK/Source/LowLevelCloth/src/windows/*.*)
	EXCLUDE_FILES(ALL_FILES GLOB_RECURSE ${MODULE_PATH}/PhysXSDK/Source/PhysX/src/device/windows/*.*)
    EXCLUDE_FILES(ALL_FILES GLOB_RECURSE ${MODULE_PATH}/PhysXSDK/Source/PhysX/src/windows/*.*)
    #EXCLUDE_FILES(ALL_FILES GLOB_RECURSE ${MODULE_PATH}/PhysXSDK/Source/foundation/include/windows/*.*)
    EXCLUDE_FILES(ALL_FILES GLOB_RECURSE ${MODULE_PATH}/PhysXSDK/Source/foundation/src/windows/*.*)
    EXCLUDE_FILES(ALL_FILES GLOB_RECURSE ${MODULE_PATH}/PhysXSDK/Source/PhysXCooking/src/windows/*.*)
ENDIF()

# 分组文件
GROUP_FILES(ALL_FILES ${CMAKE_CURRENT_SOURCE_DIR})

# 预定义宏
IF(ECHO_PLATFORM_IOS)
	ADD_DEFINITIONS(-DNDEBUG)
ENDIF()
ADD_DEFINITIONS(-DPX_PHYSX_STATIC_LIB)
ADD_DEFINITIONS(-DPX_FOUNDATION_NO_EXPORTS)
ADD_DEFINITIONS(-DPX_COOKING)	#编辑器使用之

IF(ECHO_PLATFORM_WIN32)
	ADD_DEFINITIONS(-DPX_SUPPORT_VISUAL_DEBUGGER)
ENDIF()

# 设置模块名称
SET(MODULE_NAME physx)

# 新加库
ADD_LIBRARY(${MODULE_NAME} STATIC ${ALL_FILES} CMakeLists.txt)

# 设置目标属性
SET_TARGET_PROPERTIES(${MODULE_NAME} PROPERTIES FOLDER "thirdparty")

MESSAGE(STATUS "baseserver configure success!")
